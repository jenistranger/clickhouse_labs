# Задание 2: "Загрузка и анализ данных в ClickHouse"
## Выполнили: Богданов А.А., Гребенников Т.А. Мастеница Е.А., Сенцов Д.Ю.

## Загрузка данных

### Шаг 1: Переходим на сайт для задания

Первая задача заключалась в переходе на сайт, где размещены данные для выполнения задания. На сайте представлена таблица с различными параметрами, которые необходимо будет проанализировать и обработать. 

![site_1](https://github.com/user-attachments/assets/ad5404a0-37b5-4aa6-b6ca-4f8fafdc4889)

**Рис. 1**: Страница сайта с таблицей данных.

---

### Шаг 2: Просматриваем все колонки и делаем выводы по названию и типам данных

Далее мы внимательно изучили все колонки таблицы. Были сделаны выводы о типах данных в каждой из них, а также об их значении для дальнейшей работы.

![site_2_analysis](https://github.com/user-attachments/assets/f40573b9-c599-4ae4-9d27-f1775cd2c2f6)

**Рис. 2**: Таблица с колонками и типами данных.

---

### Шаг 3: Создаем таблицу с названием `winemag` в БД `grebomas`

На основе информации о структуре данных было решено создать новую таблицу в базе данных `grebomas`. Таблица получила имя `winemag`, и для нее были определены соответствующие параметры. Все поля были настроены в соответствии с типами данных, полученными на предыдущем шаге.

![create_table](https://github.com/user-attachments/assets/25f8f8d9-0c71-4b22-bd06-e65c31e2f8ac)

**Рис. 3**: Структура таблицы `winemag` в базе данных.

---

### Шаг 4: Качаем датасет и загружаем его в таблицу

После того как таблица была подготовлена, мы приступили к скачиванию датасета и его загрузке в созданную таблицу. Процесс загрузки был успешным, и все данные были занесены в таблицу без ошибок.

![data_upload](https://github.com/user-attachments/assets/7b883fb0-7f5d-4d75-9ca2-1339a43b6c5b)

**Рис. 4**: Процесс загрузки датасета в таблицу.

---

### Шаг 5: Проверяем, что данные загрузились через DBeaver

Для подтверждения правильности загрузки данных был использован инструмент DBeaver. С помощью него мы проверили, что все данные успешно внесены в таблицу `winemag`.

![check_data](https://github.com/user-attachments/assets/211a3e28-20a5-4be5-bf16-20b067e334b3)

**Рис. 5**: Проверка загруженных данных через DBeaver.

## Анализ

### Задача 1: Только непустые значения для названий стран и цен

Для начала были отфильтрованы только те записи, в которых присутствуют непустые значения для названий стран и цен. Для демонстрации работы запроса было выведено количество строк до и после фильтрации.

![filter_1](https://github.com/user-attachments/assets/6121accc-997e-4d55-8989-63e13183d246)

**Рис. 1**: Фильтрация данных для непустых значений стран и цен.

---

### Задача 2: Максимальная цена для каждой страны

Затем была выполнена агрегация данных для определения максимальной цены вина для каждой страны. Для этого был использован метод группировки по названию страны с расчетом максимальной цены в каждой группе. Ниже приведена полная таблица.

![filter_2_1](https://github.com/user-attachments/assets/eac8c52a-c6d6-4e32-a7d5-f738b8b3d17e)

**Рис. 2**: Максимальная цена для каждой страны.



| Страна                 | Максимальная цена  |
|------------------------|-------|
| Romania                | 320.00|
| Uruguay                | 130.00|
| Chile                  | 400.00|
| Turkey                 | 120.00|
| Ukraine                | 13.00 |
| US                     | 2013.00|
| Hungary                | 764.00|
| Brazil                 | 60.00 |
| Slovenia               | 90.00 |
| Morocco                | 40.00 |
| India                  | 20.00 |
| Israel                 | 150.00|
| Peru                   | 68.00 |
| China                  | 18.00 |
| Portugal               | 1000.00|
| Canada                 | 120.00|
| France                 | 3300.00|
| Egypt                  | 0.00  |
| Georgia                | 40.00 |
| Armenia                | 15.00 |
| Italy                  | 900.00|
| Greece                 | 79.00 |
| Spain                  | 770.00|
| Mexico                 | 108.00|
| Lebanon                | 75.00 |
| Slovakia               | 16.00 |
| Cyprus                 | 21.00 |
| Austria                | 1100.00|
| England                | 95.00 |
| Moldova                | 42.00 |
| Germany                | 775.00|
| Bulgaria               | 100.00|
| Croatia                | 65.00 |
| Serbia                 | 42.00 |
| Argentina              | 230.00|
| Luxembourg             | 30.00 |
| Switzerland            | 160.00|
| Macedonia              | 20.00 |
| New Zealand            | 130.00|
| Australia              | 850.00|
| Czech Republic         | 45.00 |
| South Africa           | 330.00|
| Bosnia and Herzegovina | 13.00 |


---

### Задача 3: Топ-10 стран с самыми дорогими винами

После получения максимальных цен для каждой страны, был построен список из 10 стран с самыми дорогими винами.

![filter_3](https://github.com/user-attachments/assets/1dd02853-d5b9-4beb-b97d-d154bff70abe)

**Рис. 3**: Топ-10 стран с самыми дорогими винами.

---

### Задача 4: Определить, как высокая цена коррелирует с оценкой дегустатора

Для следующего шага было проведено исследование на предмет корреляции между ценой вина и его оценкой дегустатора. Мы использовали коэффициент корреляции для выявления зависимости между высокими ценами и высокими оценками дегустаторов. Это позволило понять, насколько дорогие вина оцениваются выше.

![filter_4](https://github.com/user-attachments/assets/917eb909-659d-4057-a68e-456ca59e396c)

**Рис. 4**: Корреляция между ценой вина и оценкой дегустатора.

---

### Задача 5: Учесть в выборке также регион производства

В заключение была проведена дополнительная агрегация, где учитывался не только фактор цены и оценки, но и регион производства вина. Это позволило расширить анализ и понять, как различные регионы могут влиять на стоимость и оценку вина. Полная таблица находится в файле `all_corr.md`

![filter_5](https://github.com/user-attachments/assets/7dced4c6-68c4-4d88-bdd9-2e83c9de510b)

**Рис. 5**: Влияние региона производства на цену и оценку вина.

---

