# Проектирование DWH

## Выполнили: Богданов А.А., Гребенников Т.А. Мастеница Е.А., Сенцов Д.Ю.


## Описание проекта
В данном проекте мы будем анализировать данные о действиях пользователей на веб-сайте с целью улучшения UX, оптимизации маркетинговых кампаний и повышения конверсии. Мы будем собирать данные о посещениях, времени на сайте, действиях пользователей (клики, переходы, поиск), а также о событиях, связанных с продуктами.

## Источники данных
- **Логи веб-сервера** (например, Nginx или Apache) с информацией о посещениях сайта.
- **API аналитических систем** (Yandex.Metrica или Google Analytics).
- **Базы данных**, содержащие информацию о пользователях и их действиях.
- **Данные о транзакциях и покупках**.

## Использование ClickHouse как DWH

ClickHouse будет использоваться как основное хранилище данных (DWH) для обработки больших объемов логов и аналитических данных. Благодаря своей способности эффективно работать с большими объемами данных и проводить агрегацию в реальном времени, ClickHouse идеально подходит для хранения и анализа данных веб-аналитики.

### Структура хранилища данных в ClickHouse

1. **Таблица посещений (visits)**:
    - **Описание**: Таблица будет хранить информацию о посещениях пользователей на веб-сайт. Каждое посещение будет записываться как отдельная строка.
    - **Поля**:
        - `visit_id (UUID)`: Уникальный идентификатор посещения.
        - `user_id (UUID)`: Идентификатор пользователя.
        - `session_id (UUID)`: Идентификатор сессии.
        - `timestamp (DateTime)`: Время посещения.
        - `page_url (String)`: URL страницы, на которую зашел пользователь.
        - `referrer_url (String)`: URL, с которого пользователь перешел на сайт.
        - `user_agent (String)`: Информация о браузере/устройстве пользователя.
        - `device_type (String)`: Тип устройства (мобильное, десктоп, планшет).
        - `ip_address (String)`: IP-адрес пользователя.

2. **Таблица событий (events)**:
    - **Описание**: Эта таблица будет хранить данные о действиях пользователя, таких как клики, скроллинг, взаимодействие с элементами страницы (кнопки, формы).
    - **Поля**:
        - `event_id (UUID)`: Уникальный идентификатор события.
        - `visit_id (UUID)`: Идентификатор посещения, к которому относится событие.
        - `timestamp (DateTime)`: Время события.
        - `event_type (String)`: Тип события (например, клик, прокрутка, ввод в форму).
        - `element_id (String)`: Идентификатор элемента страницы, с которым произошло событие.
        - `value (String)`: Дополнительные данные события (например, текст ввода в форму).

3. **Таблица транзакций (transactions)**:
    - **Описание**: Хранит информацию о транзакциях, если на сайте есть покупки или другие финансовые операции.
    - **Поля**:
        - `transaction_id (UUID)`: Идентификатор транзакции.
        - `user_id (UUID)`: Идентификатор пользователя.
        - `timestamp (DateTime)`: Время транзакции.
        - `amount (Float64)`: Сумма транзакции.
        - `product_id (UUID)`: Идентификатор товара.
        - `transaction_status (String)`: Статус транзакции (успешно/неудачно).

### ETL-процесс

1. **Извлечение данных**:
    - Данные из логов веб-сервера будут извлекаться с использованием парсинга логов через Python (например, с помощью библиотек `logparser`).
    - Данные из API аналитических систем, таких как Yandex.Metrica, могут быть получены с использованием их API, например, с помощью Python-библиотеки `requests`.
    - Транзакции будут поступать из соответствующей базы данных.

2. **Трансформация данных**:
    - Извлеченные данные будут очищены от ненужных записей и отформатированы в нужный вид (например, обработка временных меток, IP-адресов).
    - Преобразования будут выполнены с использованием Python (например, библиотека `pandas`), которая может преобразовывать и очищать данные перед загрузкой в ClickHouse.

3. **Загрузка данных в ClickHouse**:
    - Данные будут загружаться в ClickHouse с использованием метода `INSERT INTO` или через более эффективный способ — используя инструмент `clickhouse-client` для пакетной загрузки данных.
    - Можно также использовать сторонние инструменты для интеграции с ClickHouse, такие как Apache Kafka или другой брокер.

### Анализ и извлечение данных из ClickHouse

1. **Запросы для аналитики**:
    - В ClickHouse можно будет выполнять агрегацию данных по времени (например, по дням или часам), подсчитывать количество уникальных пользователей, исследовать поведение пользователей на сайте, средний чек и т.д.

2. **Инструменты для визуализации**:
    - Для визуализации данных можно использовать **Dash** (фреймворк Python) — создавать дашборды с визуализацией метрик и графиков, например, по посещаемости, действиям пользователей и т.п.

## Пример архитектуры

![image](https://github.com/user-attachments/assets/bcedbc15-ecf1-45ea-a6ec-f6f816279c38)

## Описание компонентов

1. **Логи веб-сервера** и **API аналитики** (Yandex.Metrica, Google Analytics) — источники данных о действиях пользователей.
2. **ETL-процесс**:
   - **Извлечение данных** с различных источников.
   - **Трансформация данных** с помощью Python (очистка, преобразование форматов).
   - **Загрузка в ClickHouse** с использованием `INSERT INTO` или через ETL-инструменты.
3. **ClickHouse** — основное хранилище данных, которое хранит таблицы посещений, событий и транзакций.
4. **Аналитика и SQL-запросы** — выполнение агрегации данных с помощью SQL.
5. **Инструменты визуализации**



